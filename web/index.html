<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitCodeStatic - Git ‰ªìÂ∫ìÁªüËÆ°‰∏éÁºìÂ≠òÁ≥ªÁªü</title>
    <link rel="stylesheet" href="/static/lib/element-plus.css">
    <style>
        body {
            margin: 0;
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,.12);
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .page-card {
            margin-bottom: 20px;
        }
        .stats-card {
            text-align: center;
        }
        .stats-value {
            font-size: 32px;
            font-weight: bold;
            color: #409EFF;
            margin: 10px 0;
        }
        .code-block {
            background: #f5f7fa;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        .task-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
        }
        .task-status.pending { background: #e6a23c; color: white; }
        .task-status.running { background: #409eff; color: white; }
        .task-status.completed { background: #67c23a; color: white; }
        .task-status.failed { background: #f56c6c; color: white; }
        
        .cache-card {
            transition: all 0.3s ease;
            border: 1px solid #ebeef5;
        }
        .cache-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #409eff;
        }
        .cache-card .el-card__body {
            padding: 16px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>üöÄ GitCodeStatic</h1>
            <p>Git ‰ªìÂ∫ìÁªüËÆ°‰∏éÁºìÂ≠òÁ≥ªÁªü - È´òÊÄßËÉΩ‰ª£Á†Å‰ªìÂ∫ìÊï∞ÊçÆÂàÜÊûêÂπ≥Âè∞</p>
        </div>

        <div class="container">
            <el-tabs v-model="activeTab" type="border-card">
                <!-- ‰ªìÂ∫ìÁÆ°ÁêÜ -->
                <el-tab-pane label="‰ªìÂ∫ìÁÆ°ÁêÜ" name="repos">
                    <el-card class="page-card">
                        <template #header>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>‰ªìÂ∫ìÂàóË°®</span>
                                <div>
                                    <el-button @click="loadRepos" size="small">Âà∑Êñ∞</el-button>
                                    <el-button type="primary" @click="showAddRepoDialog" size="small">ÊâπÈáèÊ∑ªÂä†</el-button>
                                </div>
                            </div>
                        </template>
                        <el-table :data="repos" border stripe v-loading="reposLoading">
                            <el-table-column prop="id" label="ID" width="80"></el-table-column>
                            <el-table-column prop="url" label="‰ªìÂ∫ìURL" min-width="300"></el-table-column>
                            <el-table-column prop="current_branch" label="ÂΩìÂâçÂàÜÊîØ" width="120"></el-table-column>
                            <el-table-column label="ËÆ§ËØÅ" width="80">
                                <template #default="scope">
                                    <el-tag v-if="scope.row.has_credentials" type="success" size="small">Â∑≤ÈÖçÁΩÆ</el-tag>
                                    <el-tag v-else type="info" size="small">Êó†</el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="status" label="Áä∂ÊÄÅ" width="120">
                                <template #default="scope">
                                    <el-tag :type="getRepoStatusType(scope.row.status)">
                                        {{ scope.row.status }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="local_path" label="Êú¨Âú∞Ë∑ØÂæÑ" min-width="200"></el-table-column>
                            <el-table-column label="Êìç‰Ωú" width="320">
                                <template #default="scope">
                                    <el-button size="small" @click="switchBranch(scope.row)">ÂàáÊç¢ÂàÜÊîØ</el-button>
                                    <el-button size="small" type="warning" @click="updateRepo(scope.row.id)">Êõ¥Êñ∞</el-button>
                                    <el-button size="small" type="info" @click="resetRepo(scope.row.id)">ÈáçÁΩÆ</el-button>
                                    <el-button size="small" type="danger" @click="deleteRepo(scope.row.id)">Âà†Èô§</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                </el-tab-pane>

                <!-- ÁªüËÆ°ÁÆ°ÁêÜ -->
                <el-tab-pane label="ÁªüËÆ°ÁÆ°ÁêÜ" name="stats">
                    <!-- ÁªüËÆ°ËÆ°ÁÆó -->
                    <el-row :gutter="20" style="margin-bottom: 20px;">
                        <el-col :span="8">
                            <el-card>
                                <template #header>Êñ∞Âª∫ÁªüËÆ°‰ªªÂä°</template>
                                <el-form :model="statsForm" size="small">
                                    <el-form-item label="‰ªìÂ∫ì">
                                        <el-select v-model="statsForm.repo_id" placeholder="ÈÄâÊã©‰ªìÂ∫ì" style="width: 100%" @change="onRepoChange">
                                            <el-option 
                                                v-for="repo in repos" 
                                                :key="repo.id" 
                                                :label="getRepoDisplayName(repo)" 
                                                :value="repo.id">
                                            </el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="ÂàÜÊîØ">
                                        <el-select 
                                            v-model="statsForm.branch" 
                                            placeholder="ÈÄâÊã©ÂàÜÊîØ" 
                                            style="width: 100%" 
                                            filterable 
                                            allow-create
                                            :loading="statsFormBranchesLoading">
                                            <el-option 
                                                v-for="branch in statsFormBranches" 
                                                :key="branch" 
                                                :label="branch" 
                                                :value="branch">
                                            </el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="Á∫¶Êùü">
                                        <el-radio-group v-model="statsForm.constraint_type" size="small">
                                            <el-radio label="commit_limit">Êèê‰∫§Êï∞</el-radio>
                                            <el-radio label="date_range">Êó•Êúü</el-radio>
                                        </el-radio-group>
                                    </el-form-item>
                                    <el-form-item v-if="statsForm.constraint_type === 'date_range'" label="Êó•ÊúüËåÉÂõ¥">
                                        <el-date-picker 
                                            v-model="statsDateRange" 
                                            type="daterange"
                                            range-separator="Ëá≥"
                                            start-placeholder="ÂºÄÂßãÊó•Êúü"
                                            end-placeholder="ÁªìÊùüÊó•Êúü"
                                            value-format="YYYY-MM-DD"
                                            style="width: 100%">
                                        </el-date-picker>
                                    </el-form-item>
                                    <el-form-item v-if="statsForm.constraint_type === 'commit_limit'" label="Êèê‰∫§Êï∞">
                                        <el-input-number v-model="statsForm.limit" :min="1" :max="10000" style="width: 100%"></el-input-number>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button type="primary" @click="calculateStats" :disabled="!statsForm.repo_id || !statsForm.branch" block>ÂºÄÂßãËÆ°ÁÆó</el-button>
                                    </el-form-item>
                                </el-form>
                            </el-card>
                        </el-col>
                        <el-col :span="16">
                            <el-card>
                                <template #header>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>ÁªüËÆ°ÁªìÊûúÂàóË°®</span>
                                        <el-button @click="loadCaches" size="small">Âà∑Êñ∞</el-button>
                                    </div>
                                </template>
                                <div v-loading="cachesLoading" style="max-height: 400px; overflow-y: auto;">
                                    <el-empty v-if="!caches || caches.length === 0" description="ÊöÇÊó†ÁªüËÆ°Êï∞ÊçÆ" :image-size="100"></el-empty>
                                    <div v-else>
                                        <div v-for="cache in caches" :key="cache.id" 
                                             style="border: 1px solid #ebeef5; border-radius: 4px; margin-bottom: 12px; padding: 12px; cursor: pointer; transition: all 0.3s;"
                                             @click="viewStatsCache(cache)"
                                             @mouseenter="$event.target.style.borderColor='#409eff'; $event.target.style.boxShadow='0 2px 12px rgba(64,158,255,0.15)'"
                                             @mouseleave="$event.target.style.borderColor='#ebeef5'; $event.target.style.boxShadow='none'">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                                <div style="font-weight: bold; color: #303133;">
                                                    {{ getRepoName(cache.repo_id) }} / {{ cache.branch }}
                                                </div>
                                                <div>
                                                    <el-tag size="small" :type="cache.constraint_type === 'date_range' ? 'success' : 'primary'">
                                                        {{ cache.constraint_type === 'date_range' ? 'Êó•ÊúüËåÉÂõ¥' : 'Êèê‰∫§Êï∞ÈôêÂà∂' }}
                                                    </el-tag>
                                                </div>
                                            </div>
                                            <div style="color: #606266; font-size: 13px; margin-bottom: 6px;">
                                                {{ getConstraintText(cache) }}
                                            </div>
                                            <div style="display: flex; justify-content: space-between; font-size: 12px; color: #909399;">
                                                <span>{{ formatDate(cache.created_at) }}</span>
                                                <span>{{ formatFileSize(cache.result_size) }} | {{ cache.hit_count }}Ê¨°ÂëΩ‰∏≠</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-card>
                        </el-col>
                    </el-row>

                    <!-- ÁªüËÆ°ËØ¶ÊÉÖÊòæÁ§∫ -->
                    <div v-if="selectedStatsResult" v-loading="statsLoading">
                        <el-row :gutter="16" style="margin-bottom: 16px;">
                            <el-col :span="6">
                                <el-card class="stats-card">
                                    <div>ÊÄªÊèê‰∫§Êï∞</div>
                                    <div class="stats-value">{{ selectedStatsResult.summary.total_commits }}</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stats-card">
                                    <div>Ë¥°ÁåÆËÄÖÊï∞</div>
                                    <div class="stats-value">{{ selectedStatsResult.summary.total_contributors }}</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stats-card">
                                    <div>Â¢ûÂä†Ë°åÊï∞</div>
                                    <div class="stats-value" style="color: #67c23a;">+{{ selectedStatsResult.summary.total_additions }}</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stats-card">
                                    <div>Âà†Èô§Ë°åÊï∞</div>
                                    <div class="stats-value" style="color: #f56c6c;">-{{ selectedStatsResult.summary.total_deletions }}</div>
                                </el-card>
                            </el-col>
                        </el-row>

                        <el-card>
                            <template #header>Ë¥°ÁåÆËÄÖËØ¶ÊÉÖ</template>
                            <el-table :data="selectedStatsResult.contributors" border stripe max-height="400">
                                <el-table-column prop="name" label="ÂßìÂêç" width="150"></el-table-column>
                                <el-table-column prop="email" label="ÈÇÆÁÆ±" width="200"></el-table-column>
                                <el-table-column prop="commit_count" label="Êèê‰∫§Êï∞" width="80" sortable></el-table-column>
                                <el-table-column prop="additions" label="Â¢ûÂä†" width="80" sortable>
                                    <template #default="scope">
                                        <span style="color: #67c23a;">+{{ scope.row.additions }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="deletions" label="Âà†Èô§" width="80" sortable>
                                    <template #default="scope">
                                        <span style="color: #f56c6c;">-{{ scope.row.deletions }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="first_commit_date" label="È¶ñÊ¨°Êèê‰∫§" width="160"></el-table-column>
                                <el-table-column prop="last_commit_date" label="ÊúÄÂêéÊèê‰∫§" width="160"></el-table-column>
                            </el-table>
                        </el-card>
                    </div>
                </el-tab-pane>

                <!-- ‰ªªÂä°ÁõëÊéß -->
                <el-tab-pane label="‰ªªÂä°ÁõëÊéß" name="tasks">
                    <el-card class="page-card">
                        <template #header>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>‰ªªÂä°ÂàóË°®</span>
                                <div>
                                    <el-button @click="loadTasks" size="small">Âà∑Êñ∞</el-button>
                                    <el-button @click="clearCompletedTasks" size="small" type="warning">Ê∏ÖÁêÜÂ∑≤ÂÆåÊàê</el-button>
                                    <el-button @click="clearAllTasks" size="small" type="danger">Ê∏ÖÁ©∫ÊâÄÊúâ</el-button>
                                </div>
                            </div>
                        </template>
                        <el-table :data="tasks" border stripe v-loading="tasksLoading">
                            <el-table-column prop="id" label="‰ªªÂä°ID" width="80"></el-table-column>
                            <el-table-column prop="task_type" label="‰ªªÂä°Á±ªÂûã" width="120">
                                <template #default="scope">
                                    <el-tag size="small">{{ scope.row.task_type }}</el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="repo_id" label="‰ªìÂ∫ìID" width="100"></el-table-column>
                            <el-table-column prop="status" label="Áä∂ÊÄÅ" width="120">
                                <template #default="scope">
                                    <el-tag :type="getTaskStatusType(scope.row.status)">
                                        {{ scope.row.status }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="priority" label="‰ºòÂÖàÁ∫ß" width="100"></el-table-column>
                            <el-table-column prop="error_message" label="ÈîôËØØ‰ø°ÊÅØ" min-width="200"></el-table-column>
                            <el-table-column prop="created_at" label="ÂàõÂª∫Êó∂Èó¥" width="180"></el-table-column>
                            <el-table-column prop="updated_at" label="Êõ¥Êñ∞Êó∂Èó¥" width="180"></el-table-column>
                        </el-table>
                    </el-card>
                </el-tab-pane>

                <!-- ÁºìÂ≠òÁÆ°ÁêÜ -->
                <el-tab-pane label="ÁºìÂ≠òÁÆ°ÁêÜ" name="caches">
                    <el-card class="page-card">
                        <template #header>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>ÁªüËÆ°ÁºìÂ≠òÂàóË°®</span>
                                <div>
                                    <el-button @click="loadCaches" size="small">Âà∑Êñ∞</el-button>
                                    <el-button @click="clearAllCaches" size="small" type="danger">Ê∏ÖÁ©∫ÁºìÂ≠ò</el-button>
                                </div>
                            </div>
                        </template>
                        <el-table :data="caches" border stripe v-loading="cachesLoading">
                            <el-table-column prop="id" label="ÁºìÂ≠òID" width="80"></el-table-column>
                            <el-table-column prop="repo_id" label="‰ªìÂ∫ìID" width="100"></el-table-column>
                            <el-table-column prop="branch" label="ÂàÜÊîØ" width="120"></el-table-column>
                            <el-table-column prop="constraint_type" label="Á∫¶ÊùüÁ±ªÂûã" width="120">
                                <template #default="scope">
                                    <el-tag size="small" :type="scope.row.constraint_type === 'commit_limit' ? 'primary' : 'success'">
                                        {{ scope.row.constraint_type === 'commit_limit' ? 'Êèê‰∫§ÈôêÂà∂' : 'Êó•ÊúüËåÉÂõ¥' }}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column prop="result_size" label="Êñá‰ª∂Â§ßÂ∞è" width="120">
                                <template #default="scope">
                                    {{ formatFileSize(scope.row.result_size) }}
                                </template>
                            </el-table-column>
                            <el-table-column prop="hit_count" label="ÂëΩ‰∏≠Ê¨°Êï∞" width="100"></el-table-column>
                            <el-table-column prop="created_at" label="ÂàõÂª∫Êó∂Èó¥" width="180"></el-table-column>
                            <el-table-column prop="last_hit_at" label="ÊúÄÂêéÂëΩ‰∏≠" width="180">
                                <template #default="scope">
                                    {{ scope.row.last_hit_at || '-' }}
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-card>
                </el-tab-pane>

                <!-- API ÊñáÊ°£ -->
                <el-tab-pane label="API ÊñáÊ°£" name="api">
                    <el-card class="page-card">
                        <template #header>Swagger API ÊñáÊ°£</template>
                        <p>ËÆøÈóÆ <a href="/swagger/index.html" target="_blank" style="color: #409EFF;">/swagger/index.html</a> Êü•ÁúãÂÆåÊï¥ÁöÑ API ÊñáÊ°£</p>
                        <el-divider></el-divider>
                        <h3>Âø´ÈÄüÂºÄÂßã</h3>
                        <div class="code-block">
curl -X POST http://localhost:8080/api/v1/repos/batch \
  -H "Content-Type: application/json" \
  -d '{
    "repos": [
      {"url": "https://github.com/user/repo.git", "branch": "main"}
    ]
  }'
                        </div>
                    </el-card>
                </el-tab-pane>
            </el-tabs>
        </div>

        <!-- Ê∑ªÂä†‰ªìÂ∫ìÂØπËØùÊ°Ü -->
        <el-dialog v-model="addRepoVisible" title="ÊâπÈáèÊ∑ªÂä†‰ªìÂ∫ì" width="600px">
            <el-form :model="addRepoForm" label-width="100px">
                <el-form-item label="‰ªìÂ∫ìURL">
                    <el-input 
                        v-model="addRepoForm.urls" 
                        type="textarea" 
                        :rows="6"
                        placeholder="ÊØèË°å‰∏Ä‰∏™‰ªìÂ∫ìURLÔºåÊ†ºÂºèÔºöhttps://github.com/user/repo.git">
                    </el-input>
                </el-form-item>
                <el-form-item label="ÈªòËÆ§ÂàÜÊîØ">
                    <el-input v-model="addRepoForm.branch" placeholder="main"></el-input>
                </el-form-item>
                <el-divider content-position="left">ËÆ§ËØÅ‰ø°ÊÅØÔºàÂèØÈÄâÔºâ</el-divider>
                <el-form-item label="Áî®Êà∑Âêç">
                    <el-input v-model="addRepoForm.username" placeholder="Â¶ÇÈúÄËÆ§ËØÅÔºåËØ∑ËæìÂÖ•Áî®Êà∑Âêç" clearable></el-input>
                </el-form-item>
                <el-form-item label="ÂØÜÁ†Å/Token">
                    <el-input v-model="addRepoForm.password" type="password" placeholder="Â¶ÇÈúÄËÆ§ËØÅÔºåËØ∑ËæìÂÖ•ÂØÜÁ†ÅÊàñToken" show-password clearable></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="addRepoVisible = false">ÂèñÊ∂à</el-button>
                <el-button type="primary" @click="addRepos">Á°ÆÂÆö</el-button>
            </template>
        </el-dialog>

        <!-- ÂàáÊç¢ÂàÜÊîØÂØπËØùÊ°Ü -->
        <el-dialog v-model="switchBranchVisible" title="ÂàáÊç¢ÂàÜÊîØ" width="500px">
            <el-form :model="switchBranchForm" label-width="100px" v-loading="branchesLoading">
                <el-form-item label="‰ªìÂ∫ì">
                    <el-input :value="switchBranchForm.repoUrl" disabled></el-input>
                </el-form-item>
                <el-form-item label="ÂΩìÂâçÂàÜÊîØ">
                    <el-tag>{{ switchBranchForm.currentBranch }}</el-tag>
                </el-form-item>
                <el-form-item label="ÈÄâÊã©ÂàÜÊîØ">
                    <el-select v-model="switchBranchForm.branch" placeholder="ÈÄâÊã©ÂàÜÊîØ" style="width: 100%;" filterable allow-create>
                        <el-option 
                            v-for="branch in branches" 
                            :key="branch" 
                            :label="branch" 
                            :value="branch">
                        </el-option>
                    </el-select>
                    <div style="margin-top: 8px; font-size: 12px; color: #909399;">
                        ÂèØ‰ª•‰ªéÂàóË°®ÈÄâÊã©ÊàñÊâãÂä®ËæìÂÖ•ÂàÜÊîØÂêç
                    </div>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="switchBranchVisible = false">ÂèñÊ∂à</el-button>
                <el-button type="primary" @click="confirmSwitchBranch" :disabled="!switchBranchForm.branch">Á°ÆÂÆö</el-button>
            </template>
        </el-dialog>
    </div>

    <script src="/static/lib/vue.global.prod.js"></script>
    <script src="/static/lib/element-plus.min.js"></script>
    <script src="/static/lib/axios.min.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
